// ================== ТЕМА (светлая/тёмная) ==================
const themeToggle = document.getElementById("themeToggle");
const root = document.documentElement;

function setTheme(theme) {
  root.setAttribute("data-theme", theme);
  const icon = themeToggle.querySelector("i");
  const text = themeToggle.querySelector("span");

  if (theme === "dark") {
    icon.className = "ti ti-moon";
    text.textContent = "Тёмная тема";
  } else {
    icon.className = "ti ti-sun-high";
    text.textContent = "Светлая тема";
  }
  localStorage.setItem("theme", theme);
}

setTheme(localStorage.getItem("theme") || "light");

themeToggle.addEventListener("click", () => {
  const current = root.getAttribute("data-theme");
  setTheme(current === "light" ? "dark" : "light");
});

// ================== ПЛАВНАЯ ПРОКРУТКА ПО ЯКОРЯМ ==================
document.querySelectorAll('a[href^="#"]').forEach(a => {
  a.addEventListener("click", (e) => {
    const id = a.getAttribute("href");
    const el = document.querySelector(id);
    if (!el) return;
    e.preventDefault();
    el.scrollIntoView({ behavior: "smooth", block: "start" });
    history.pushState(null, "", id);
  });
});

// ================== REVEAL (появление секций) ==================
const revealEls = document.querySelectorAll(".reveal");
const revealObs = new IntersectionObserver((entries) => {
  entries.forEach(ent => {
    if (ent.isIntersecting) ent.target.classList.add("show");
  });
}, { threshold: 0.12 });

revealEls.forEach(el => revealObs.observe(el));

// ================== СКРОЛЛ-ПРОГРЕСС + КНОПКА "НАВЕРХ" ==================
const scrollProgress = document.getElementById("scrollProgress");
const toTop = document.getElementById("toTop");

function onScroll() {
  const h = document.documentElement;
  const scrolled = h.scrollTop;
  const max = h.scrollHeight - h.clientHeight;
  const p = max > 0 ? (scrolled / max) * 100 : 0;
  scrollProgress.style.width = `${p}%`;

  if (scrolled > 500) toTop.classList.add("show");
  else toTop.classList.remove("show");
}
window.addEventListener("scroll", onScroll);
onScroll();

toTop.addEventListener("click", () => {
  window.scrollTo({ top: 0, behavior: "smooth" });
});

// ================== ГОД В ФУТЕРЕ ==================
document.getElementById("year").textContent = new Date().getFullYear();

// ================== ДАННЫЕ УЧИТЕЛЕЙ (БОЛЬШЕ) ==================
const teachers = [
  {
    name: "Ольга Викторовна",
    subject: "Математика",
    desc: "Победитель «Учитель года», 15 лет опыта подготовки к олимпиадам.",
    photo: "https://images.unsplash.com/photo-1544717305-2782549b5136?auto=format&fit=crop&w=1000&q=80",
    cabinet: "205",
    email: "math@licei-bud.kz"
  },
  {
    name: "Артём Игоревич",
    subject: "Английский язык",
    desc: "Разговорные клубы, подготовка к международным экзаменам, проекты на английском.",
    photo: "https://images.unsplash.com/photo-1601412436009-d964bd02edbc?auto=format&fit=crop&w=1000&q=80",
    cabinet: "210",
    email: "eng@licei-bud.kz"
  },
  {
    name: "Елена Сергеевна",
    subject: "Информатика",
    desc: "Python, веб-разработка и робототехника. Помогает собрать портфолио.",
    photo: "https://images.unsplash.com/photo-1580894908361-967195033215?auto=format&fit=crop&w=1000&q=80",
    cabinet: "402",
    email: "it@licei-bud.kz"
  },
  {
    name: "Сергей Константинович",
    subject: "Физика",
    desc: "Лабораторные, эксперименты и подготовка к олимпиадам. Стаж 12 лет.",
    photo: "https://images.unsplash.com/photo-1548142813-c348350df52b?auto=format&fit=crop&w=1000&q=80",
    cabinet: "320",
    email: "physics@licei-bud.kz"
  },
  {
    name: "Наталья Николаевна",
    subject: "Музыка",
    desc: "Вокал, ансамбль и выступления. Готовит школьные концерты.",
    photo: "https://images.unsplash.com/photo-1524503033411-fd26f86da3e0?auto=format&fit=crop&w=1000&q=80",
    cabinet: "217",
    email: "music@licei-bud.kz"
  },
  {
    name: "Ирина Михайловна",
    subject: "История",
    desc: "Дебаты, анализ источников, подготовка к экзаменам и проектным работам.",
    photo: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?auto=format&fit=crop&w=1000&q=80",
    cabinet: "301",
    email: "history@licei-bud.kz"
  },
  {
    name: "Данияр Рустемович",
    subject: "Химия",
    desc: "Практикумы, безопасные опыты, олимпиадная подготовка. Стаж 10 лет.",
    photo: "https://images.unsplash.com/photo-1556157382-97eda2d62296?auto=format&fit=crop&w=1000&q=80",
    cabinet: "312",
    email: "chem@licei-bud.kz"
  },
  {
    name: "Виктория Андреевна",
    subject: "Биология",
    desc: "Кружок «Юный биолог», проекты и экология. Много практики.",
    photo: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?auto=format&fit=crop&w=1000&q=80",
    cabinet: "318",
    email: "bio@licei-bud.kz"
  }
];

const teachersSlider = document.getElementById("teachersSlider");

function renderTeachers() {
  teachersSlider.innerHTML = "";
  teachers.forEach(t => {
    const card = document.createElement("article");
    card.className = "card teacher-card";
    card.innerHTML = `
      <img src="${t.photo}" alt="${t.subject}" loading="lazy" />
      <div class="pad">
        <h3>${t.name}</h3>
        <p class="subject">${t.subject}</p>
        <p class="muted">${t.desc}</p>
        <div class="teacher-meta">
          <span class="pill"><i class="ti ti-door"></i> Каб. ${t.cabinet}</span>
          <span class="pill"><i class="ti ti-mail"></i> ${t.email}</span>
        </div>
      </div>
    `;
    teachersSlider.appendChild(card);
  });
}
renderTeachers();

// Плавное "перелистывание" слайдера
const prevBtn = document.getElementById("teachersPrev");
const nextBtn = document.getElementById("teachersNext");

function slideBy(direction) {
  const card = teachersSlider.querySelector(".teacher-card");
  const step = card ? (card.getBoundingClientRect().width + 14) : 340;
  teachersSlider.scrollBy({ left: direction * step, behavior: "smooth" });
}

prevBtn.addEventListener("click", () => slideBy(-1));
nextBtn.addEventListener("click", () => slideBy(1));

// ================== СЧЁТЧИКИ (статистика) ==================
const counters = document.querySelectorAll(".stat-number");
let countersStarted = false;

function animateCount(el, to) {
  const dur = 900;
  const start = performance.now();
  const from = 0;

  function tick(now) {
    const t = Math.min(1, (now - start) / dur);
    const val = Math.round(from + (to - from) * (1 - Math.pow(1 - t, 3)));
    el.textContent = val + (to === 92 || to === 98 ? "%" : "");
    if (t < 1) requestAnimationFrame(tick);
  }
  requestAnimationFrame(tick);
}

const statsSection = document.getElementById("stats");
const statsObs = new IntersectionObserver((entries) => {
  entries.forEach(ent => {
    if (!ent.isIntersecting || countersStarted) return;
    countersStarted = true;

    counters.forEach(el => {
      const to = Number(el.dataset.count || "0");
      animateCount(el, to);
    });

    // Прогресс-бары
    document.querySelectorAll(".bar").forEach(b => b.classList.add("ready"));
  });
}, { threshold: 0.25 });

if (statsSection) statsObs.observe(statsSection);

// ================== ГАЛЕРЕЯ + МОДАЛКА ==================
const galleryData = [
  { url: "https://images.unsplash.com/photo-1523240795612-9a054b0db644?auto=format&fit=crop&w=1200&q=80", cap: "Проектная работа" },
  { url: "https://images.unsplash.com/photo-1519452635265-7b1fbfd1e4e0?auto=format&fit=crop&w=1200&q=80", cap: "Урок в классе" },
  { url: "https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=1200&q=80", cap: "Командная работа" },
  { url: "https://images.unsplash.com/photo-1529070538774-1843cb3265df?auto=format&fit=crop&w=1200&q=80", cap: "Олимпиадная подготовка" },
  { url: "https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&w=1200&q=80", cap: "Библиотека" },
  { url: "https://images.unsplash.com/photo-1523050854058-8df90110c9f1?auto=format&fit=crop&w=1200&q=80", cap: "Выпускной" },
  { url: "https://images.unsplash.com/photo-1523580846011-d3a5bc25702b?auto=format&fit=crop&w=1200&q=80", cap: "Спортивный день" },
  { url: "https://images.unsplash.com/photo-1529390079861-591de354faf5?auto=format&fit=crop&w=1200&q=80", cap: "Экскурсия" }
];

const galleryGrid = document.getElementById("galleryGrid");
const imgModal = document.getElementById("imgModal");
const modalImg = document.getElementById("modalImg");

function openModal(src) {
  modalImg.src = src;
  imgModal.classList.add("show");
  imgModal.setAttribute("aria-hidden", "false");
  document.body.style.overflow = "hidden";
}

function closeModal() {
  imgModal.classList.remove("show");
  imgModal.setAttribute("aria-hidden", "true");
  modalImg.src = "";
  document.body.style.overflow = "";
}

function renderGallery() {
  if (!galleryGrid) return;
  galleryGrid.innerHTML = "";
  galleryData.forEach((g, idx) => {
    const item = document.createElement("div");
    item.className = "gallery-item";
    item.innerHTML = `
      <img src="${g.url}" alt="${g.cap}" loading="lazy" />
      <div class="cap">${g.cap}</div>
    `;
    item.addEventListener("click", () => openModal(g.url));
    galleryGrid.appendChild(item);
  });
}
renderGallery();

imgModal?.addEventListener("click", (e) => {
  if (e.target && e.target.dataset && e.target.dataset.close) closeModal();
});

window.addEventListener("keydown", (e) => {
  if (e.key === "Escape" && imgModal.classList.contains("show")) closeModal();
});

// ================== ФОРМА (демо) ==================
const contactForm = document.getElementById("contactForm");
const formHint = document.getElementById("formHint");

contactForm?.addEventListener("submit", (e) => {
  e.preventDefault();
  const fd = new FormData(contactForm);
  const name = (fd.get("name") || "").toString().trim();
  formHint.textContent = `Спасибо, ${name || "друг"}! Заявка отправлена (демо).`;
  contactForm.reset();
});
